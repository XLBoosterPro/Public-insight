<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <title>Monthly Sales Trends</title>
    <script src='https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js'></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f8f9fa; color: #333333; }
        .chart-container { width: 85%; height: 650px; margin: 40px auto; padding: 30px; background: #ffffff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 1px solid #cccccc; position: relative; }
        .fullscreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; margin: 0; padding: 20px; z-index: 9998; box-sizing: border-box; overflow: hidden; }
        .chart-title { text-align: center; font-size: 20px; font-weight: bold; margin-bottom: 25px; color: #333333; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; }
        .modal-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 250px; background: #ffffff; color: #333333; padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); text-align: center; font-family: Arial; }
        .modal-title { margin-top: 0; font-size: 16px; margin-bottom: 10px; border-bottom: 1px solid #cccccc; padding-bottom: 5px; font-weight:bold; }
        .fmt-btn { display: block; width: 100%; padding: 8px; margin: 6px 0; background: #f0f0f0; border: 1px solid #cccccc; border-radius: 4px; cursor: pointer; color: #333333; font-size: 12px; transition: 0.2s; }
        .fmt-btn:hover { background: #e0e0e0; }
        .close-btn { margin-top: 10px; background: transparent; border: none; color: #333333; padding: 5px; cursor: pointer; font-size: 12px; text-decoration:underline; }
    </style>
</head>
<body>
    <div id='lblModal' class='modal-overlay'>
        <div class='modal-box'>
            <div class='modal-title'>Label Settings</div>
            <button id='btnToggle' class='fmt-btn' style='font-weight:bold;' onclick="toggleLabels()">Show/Hide Labels</button>
            <hr style='margin:8px 0; border:0; border-top:1px solid #cccccc; opacity:0.5;'>
            <button class='fmt-btn' onclick="setLabelMode('raw')">Actual Value (1,200)</button>
            <button class='fmt-btn' onclick="setLabelMode('auto')">Auto Format (1K, 1M)</button>
            <button class='fmt-btn' onclick="setLabelMode('K')">Thousands (50K)</button>
            <button class='fmt-btn' onclick="setLabelMode('M')">Millions (1.5M)</button>
            <button class='close-btn' onclick="closeModal()">Close</button>
        </div>
    </div>
    <div class='chart-container'>
        <div class='chart-title'>Monthly Sales Trends</div>
        <div id='chartBox' style='width: 100%; height: 90%;'></div>
    </div>
    <script>
    var currentFilename = 'Chart_Line.html';
    var currentTitle = 'Monthly Sales Trends';
    var currentXName = 'Month';
    var currentYName = 'Sales';
    var currencySym = '\u20B9';
    var currentLabelMode = 'none';
    var labelsVisible = false;
    const colors = ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae'];
        var myChart = echarts.init(document.getElementById('chartBox'), null, {renderer: 'canvas'});
        var toolboxFeatures = {
             myFull: {
                 show: true, title: 'Full Screen', icon: 'path://M5,5h5V3H3v7h2V5z M14,3v2h5v5h2V3H14z M19,19h-5v2h7v-7h-2V19z M5,14H3v7h7v-2H5V14z',
                 onclick: function() {
                     var container = document.querySelector('.chart-container');
                     container.classList.toggle('fullscreen');
                     setTimeout(function(){ myChart.resize(); }, 100);
                 }
             },
             myLabelSettings: {
                 show: true, title: 'Label Settings', icon: 'path://M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z M11,12H9v-2h2V12z M11,9H9V7h2V9z M11,6H9V4h2V6z',
                 onclick: function() {
                     document.getElementById('lblModal').style.display = 'block';
                 }
             },
             myEditTitle: {
                 show: true, title: 'Edit Labels', icon: 'path://M17.8,2l2.2,2.2c0.3,0.3,0.3,0.7,0,1l-1.3,1.3l-3.2-3.2l1.3-1.3C17.1,1.7,17.5,1.7,17.8,2z M14.3,3.9l3.2,3.2L5.4,19.3H2.2v-3.2L14.3,3.9z',
                 onclick: function() {
                     var t = prompt('Enter Chart Title:', currentTitle);
                     if(t !== null) { currentTitle = t; document.querySelector('.chart-title').innerText = t; }
                     var x = prompt('Enter X-Axis Label:', currentXName);
                     if(x !== null) { currentXName = x; myChart.setOption({ xAxis: { name: x } }); }
                     var y = prompt('Enter Y-Axis Label:', currentYName);
                     if(y !== null) { currentYName = y; myChart.setOption({ yAxis: { name: y } }); }
                 }
             },
             mySaveChanges: {
                 show: true, title: 'Save Changes', icon: 'path://M15,1H3C1.9,1,1,1.9,1,3v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5L15,1z M9,17H5v-5h4V17z M15,17h-4v-5H5v5H3V3h2v4h8V3h1.2L17,5.8V17H15z',
                 onclick: function() {
                     var htmlContent = document.documentElement.outerHTML;
                     htmlContent = htmlContent.replace(/var currentTitle = '.*?';/, "var currentTitle = '" + currentTitle + "';");
                     htmlContent = htmlContent.replace(/var currentXName = '.*?';/, "var currentXName = '" + currentXName + "';");
                     htmlContent = htmlContent.replace(/var currentYName = '.*?';/, "var currentYName = '" + currentYName + "';");
                     htmlContent = htmlContent.replace(/_echarts_instance_=\"[^\"]*\"/g, '');
                     var a = document.createElement('a');
                     a.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent);
                     a.download = currentFilename;
                     document.body.appendChild(a);
                     a.click();
                     document.body.removeChild(a);
                 }
             },
             mySaveImage: {
                 show: true, title: 'Save Image (PNG)', icon: 'path://M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M5,19V5h14v14H5z M13.5,13.5l-2.5,3l-1.5-2l-2.5,3h9L13.5,13.5z',
                 onclick: function() {
                     myChart.setOption({ toolbox: { show: false } });
                     setTimeout(function() {
                         html2canvas(document.querySelector('.chart-container'), {backgroundColor: '#ffffff'}).then(function(canvas) {
                             var a = document.createElement('a');
                             a.href = canvas.toDataURL('image/png');
                             a.download = currentFilename.replace('.html', '.png');
                             a.click();
                             myChart.setOption({ toolbox: { show: true } });
                         });
                     }, 100);
                 }
             },
             restore: { show: true, title: 'Restore' },
             dataView: { show: true, title: 'Data View', readOnly: false },
             magicType: { show: true, type: ['line', 'bar', 'stack'], title: {line: 'Line', bar: 'Bar', stack: 'Stack'} }
        };
        var option = {
            backgroundColor: '#ffffff',
            color: colors,
            animation: true,
            title: { show: false, text: currentTitle },
            tooltip: {
                show: true, trigger: 'item', axisPointer: { type: 'none' }, 
                textStyle: {fontSize: 14, color: '#333333'}, borderWidth: 0, padding: 5,
            },
            toolbox: {
                show: true, orient: 'horizontal', itemSize: 15, itemGap: 10, left: '75%',
                feature: toolboxFeatures,
                iconStyle: { borderColor: '#666666' }
            },
            legend: { show: true, type: 'scroll', left: 'center', top: 'top', padding: [0,0,20,0], textStyle: { color: '#333333' } },
            grid: { left: '5%', right: '12%', top: '60', bottom: '15%', containLabel: true, borderColor: '#cccccc' },
            xAxis: [{
                type: 'category', name: currentXName, nameLocation: 'end', data: ["January","February","March","April","May","June","July","August","September","October","November","December"],
                nameTextStyle: { color: '#333333', fontWeight: 'bold' },
                axisLabel: { color: '#333333', fontWeight: 'bold' },
                axisLine: { show: true, lineStyle: { color: '#408080', width: 2 } }
            }],
            yAxis: [{
                type: 'value', name: currentYName, nameTextStyle: { color: '#333333', fontWeight: 'bold' },
                axisLabel: { color: '#333333', fontWeight: 'bold' },
                splitLine:{show:true,lineStyle:{width:1,color:'#e0e0e0'}}
            }],
            dataZoom: [ { type: 'slider', show: true,  }, { type: 'inside', show: true } ],
            series: [{type: 'line', name: "Product A", smooth: true, symbol: 'circle', symbolSize: 6, lineStyle: { width: 2 }, barGap: '10%', barCategoryGap: '20%', label: { show: false, position: 'top', margin: 8, fontFamily: 'Arial', fontSize: 10, color: '#333333' }, data: [900000,1000000,1200000,1400000,1600000,1900000,2100000,2000000,1800000,1600000,1500000,1300000]},{type: 'line', name: "Product B", smooth: true, symbol: 'circle', symbolSize: 6, lineStyle: { width: 2 }, barGap: '10%', barCategoryGap: '20%', label: { show: false, position: 'top', margin: 8, fontFamily: 'Arial', fontSize: 10, color: '#333333' }, data: [1400000,1600000,1900000,2200000,2500000,2900000,3200000,3100000,2800000,2500000,2300000,2000000]}]
        };
        myChart.setOption(option);
        window.addEventListener('resize', function() { myChart.resize(); });
        function closeModal() { document.getElementById('lblModal').style.display = 'none'; }
        function updateToggleText() {
            var btn = document.getElementById('btnToggle');
            if(labelsVisible) {
                btn.innerText = 'Hide Labels';
                btn.style.opacity = '1';
            } else {
                btn.innerText = 'Show Labels';
                btn.style.opacity = '0.7';
            }
        }
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            if(currentLabelMode === 'none') currentLabelMode = 'auto';
            updateToggleText();
            refreshLabels();
        }
        function setLabelMode(mode) {
            if(mode !== 'none') currentLabelMode = mode;
            labelsVisible = (mode !== 'none');
            updateToggleText();
            refreshLabels();
            closeModal();
        }
        function refreshLabels() {
            var fmtFunc;
            if(currentLabelMode === 'raw') {
                 // Actual Value with Commas
                 fmtFunc = (p) => currencySym + p.value.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 2});
            } else if(currentLabelMode === 'auto') {
                 fmtFunc = function(p) { var n=p.value; if(n<1000) return currencySym+n.toFixed(0); var m=Math.floor(Math.log(Math.abs(n))/Math.log(1000)); return currencySym+(n/Math.pow(1000,m)).toFixed(1)+['','K','M','B'][m]; };
            } else if (currentLabelMode === 'K') {
                 fmtFunc = function(p) { return currencySym + (p.value/1000).toFixed(1) + 'K'; };
            } else if (currentLabelMode === 'M') {
                 fmtFunc = function(p) { return currencySym + (p.value/1000000).toFixed(2) + 'M'; };
            }
            var opt = myChart.getOption();
            if(opt.series) {
                 opt.series.forEach(function(s){
                     s.label = s.label || {};
                     s.label.show = labelsVisible;
                     if(labelsVisible && fmtFunc) s.label.formatter = fmtFunc;
                     s.label.position = 'top';
                 });
                 myChart.setOption(opt);
            }
        }
        updateToggleText();
        window.addEventListener('resize', function() { myChart.resize(); });
        myChart.on('magictypechanged', function (params) {
             setTimeout(()=>refreshLabels(), 50);
        });
    </script>
</body></html>
